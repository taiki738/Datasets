# 画像評価アンケートツール

## 概要

本プロジェクトは、高品質な顔画像データセットを構築するため、主観的な評価を収集することを目的としたWebベースのアンケートツールです。フィルタリングされた`UTKFace`データセットを元に、参加者は一連の顔画像を5段階の星評価で評価します。収集されたデータは、将来の機械学習モデル（VAE、LDMなど）の訓練に活用されます。

## 主な機能

- **Webインターフェース:** PCやスマートフォンなど、ローカルネットワーク上の任意のデバイスからアクセス可能です。
- **ランダム化されたセッション:** 1セッションあたり、ランダムに選ばれた男性10枚・女性10枚の合計20枚の画像が表示されます。
- **インタラクティブな評価:** Googleマップ風の5段階星評価システム（`★★★★★`）を採用し、直感的な操作を実現しています。
- **セグメント化されたプログレスバー:** アンケート全体の進捗と、現在のセクション（男性/女性）を視覚的に表示します。男性は青、女性はピンクで色分けされます。
- **案内画面:** 各セクション（男性/女性）の開始前に、評価内容を説明する案内画面を表示し、ユーザーを適切に誘導します。
- **属性情報の収集:** すべての評価が完了した後、任意で回答可能な属性情報（年齢・性別）の入力フォームが表示されます。
- **データベースによる永続化:** すべての評価、参加者セッション、属性情報は`SQLite`データベースに効率的に保存・管理されます。

## 実行方法

1.  **仮想環境のセットアップと有効化**
    プロジェクトルートで以下のコマンドを実行し、Pythonの仮想環境をセットアップ・有効化します。
    ```bash
    # まだ仮想環境がない場合
    python -m venv .venv
    
    # 仮想環境を有効化 (macOS/Linux)
    source .venv/bin/activate
    ```

2.  **依存関係のインストール**
    必要なライブラリをインストールします。
    ```bash
    pip install -r requirements.txt
    ```

3.  **アプリケーションの実行**
    以下のコマンドでWebサーバーを起動します。
    ```bash
    python image_labeler/app.py
    ```
    ターミナルにローカルIPアドレスとQRコードが表示されるので、PCのブラウザで`http://localhost:5001`にアクセスするか、スマートフォンでQRコードをスキャンしてください。

4.  **データベースの更新（注意）**
    `image_labeler/app.py`内のデータベースモデル（テーブル定義）を変更した場合は、古いデータベースファイルとの間に互換性がなくなります。その際は、サーバーを停止し、以下のコマンドでデータベースファイルを一度削除してから、再度サーバーを起動してください。
    ```bash
    rm instance/survey.db
    ```

## データベーススキーマ

収集されたデータは3つのテーブルで管理されます。

### 1. `Participant` テーブル
アンケートの回答者（被験者）一人ひとりを区別するためのテーブルです。

| カラム名 | データ型 | 説明 |
| :--- | :--- | :--- |
| `id` | 整数 | 回答者を一意に識別するID |
| `created_at` | 日時 | セッションが開始された日時 |
| `age` | 整数 | 回答者の年齢（任意回答） |
| `gender` | 文字列 | 回答者の性別（任意回答） |

### 2. `Image` テーブル
評価対象となるすべての画像を管理するテーブルです。

| カラム名 | データ型 | 説明 |
| :--- | :--- | :--- |
| `id` | 整数 | 画像を一意に識別するID |
| `filename` | 文字列 | 画像のファイル名 |
| `gender` | 文字列 | 画像の性別（`male`または`female`） |

### 3. `Label` テーブル
**誰が、どの画像に、どんな評価をしたか**を記録する、本ツールの中心となるテーブルです。

| カラム名 | データ型 | 説明 |
| :--- | :--- | :--- |
| `id` | 整数 | 各評価を一意に識別するID |
| `participant_id` | 整数 | どの回答者が評価したかを示すID (`Participant`テーブルに紐づく) |
| `image_id` | 整数 | どの画像が評価されたかを示すID (`Image`テーブルに紐づく) |
| `rating` | 整数 | 評価スコア（1〜5の数字） |
| `created_at` | 日時 | 評価が行われた日時 |

---
*This tool was developed with the assistance of the Gemini CLI.*
