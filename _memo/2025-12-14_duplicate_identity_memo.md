# 同一人物の画像の取り扱いに関する考察

## 概要

画像生成モデル、特に人の顔を生成するモデルを訓練する際、訓練データセットに同一人物の画像が複数含まれている場合の取り扱い方法は、生成される顔の多様性と品質に直接的な影響を与える重要な課題である。

本ドキュメントは、この課題に対する問題点と、考えられる戦略をまとめたものである。

## 問題の所在：過学習（Overfitting）のリスク

もし「魅力的」とラベリングされた訓練データセット内に、特定の人物の画像が多数存在する場合、モデルはその人物の顔の特徴を過剰に学習してしまう（過学習）。

これにより、以下のような問題が発生する可能性がある。

-   **多様性の欠如:** 生成される顔が、データセットに頻出した特定の人物に酷似したものばかりになる。
-   **汎化性能の低下:** モデルが「魅力的な顔の一般的な特徴」ではなく、「特定の個人の顔」を記憶してしまい、未知の魅力的な顔を生成する能力が低下する。

## 対処戦略

この問題に対処するため、モデル訓練の前に、データセットに対して以下のような前処理やサンプリング戦略を適用することが推奨される。

### 1. 人物の特定（クラスタリング）

-   **手法:**
    顔認証モデル（例: ArcFace, FaceNet）を利用して、各顔画像から特徴量ベクトル（Embedding）を抽出する。ベクトル間の距離を計算し、近しいものを同一人物としてグルーピング（クラスタリング）する。
-   **目的:**
    データセット内の「人物ごとの画像群」を特定する。

### 2. 学習データのサンプリング戦略

人物のクラスタリング後、以下のいずれかの戦略に基づき、学習に使用する画像を慎重に選択する。

-   **戦略 A：厳密な重複排除（Deduplication）**
    -   **内容:** 各人物クラスタから、代表画像を1枚（または少数）のみ選択する。
    -   **利点:** 最大限の「人物多様性」を確保し、モデルの汎化を促進する。
    -   **欠点:** 訓練データの総量が減少する。

-   **戦略 B：バランスの取れたサンプリング（Balanced Sampling）**
    -   **内容:** 同一人物の画像もデータセットに含めるが、データローダーがバッチを作成する際に、特定の人物が偏って選ばれないようにサンプリング処理を調整する。
    -   **利点:** データ量を維持しつつ、過学習リスクを抑制できる。
    -   **欠点:** 実装がやや複雑になる。

-   **戦略 C：データ拡張としての利用**
    -   **内容:** 同一人物の異なるアングルや表情の画像を、自然なデータ拡張と見なす。
    -   **注意:** 各人物あたりの画像枚数が均等に近い場合に有効。偏りがある場合は過学習リスクが高い。

## 結論

ラベリングによるデータ収集が完了した後、本格的なモデル訓練を開始する前に、顔認証技術を用いた**人物クラスタリング**を行い、その結果に基づいて**重複排除**や**バランスサンプリング**といった戦略を適用することが、最終的な生成モデルの品質を保証する上で極めて重要である。
